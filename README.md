# üìö TransBooks Bot

Telegram-–±–æ—Ç –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ –∫–Ω–∏–≥ (PDF/EPUB) —Å –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ –Ω–∞ —Ä—É—Å—Å–∫–∏–π —Å –ø–æ–º–æ—â—å—é OpenAI. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –æ–±–ª–æ–∂–∫–∏. –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram Stars.

**–ë–æ—Ç:** [@tg_transbooks_bot](https://t.me/tg_transbooks_bot)

---

## ‚ö° –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üìÑ –ü–µ—Ä–µ–≤–æ–¥ PDF –∏ EPUB ‚Üí PDF / EPUB –Ω–∞ –≤—ã–±–æ—Ä
- üñºÔ∏è –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–π –∏ –æ–±–ª–æ–∂–µ–∫
- üí´ –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Telegram Stars (20 ‚≠ê ‚âà 50 —Å—Ç—Ä–∞–Ω–∏—Ü)
- üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –ø–æ–¥–∞—Ä–æ–∫ –∑–≤—ë–∑–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- üìä –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –ø–µ—Ä–µ–≤–æ–¥–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
pdf-translator-bot/
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ main.py          # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∑–∞–ø—É—Å–∫ polling
‚îÇ   ‚îú‚îÄ‚îÄ config.py        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ .env
‚îÇ   ‚îú‚îÄ‚îÄ handlers.py      # Telegram-—Ö—ç–Ω–¥–ª–µ—Ä—ã (–∫–æ–º–∞–Ω–¥—ã, callback, –ø–ª–∞—Ç–µ–∂–∏)
‚îÇ   ‚îú‚îÄ‚îÄ database.py      # SQLite —á–µ—Ä–µ–∑ aiosqlite (users, transactions)
‚îÇ   ‚îú‚îÄ‚îÄ auth.py          # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ —Å–µ–∫—Ä–µ—Ç–Ω–æ–º—É —Å–ª–æ–≤—É + whitelist
‚îÇ   ‚îú‚îÄ‚îÄ extractor.py     # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞/–∫–∞—Ä—Ç–∏–Ω–æ–∫ –∏–∑ PDF/EPUB ‚Üí Markdown
‚îÇ   ‚îú‚îÄ‚îÄ translator.py    # –ü–µ—Ä–µ–≤–æ–¥ —á–µ—Ä–µ–∑ OpenAI API (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —á–∞–Ω–∫–∏)
‚îÇ   ‚îú‚îÄ‚îÄ generator.py     # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF (WeasyPrint) –∏ EPUB (ebooklib)
‚îÇ   ‚îî‚îÄ‚îÄ cover.py         # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–±–ª–æ–∂–µ–∫ (Pillow)
‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îî‚îÄ‚îÄ book.css         # –°—Ç–∏–ª–∏ –¥–ª—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö PDF
‚îú‚îÄ‚îÄ data/                # Runtime: –ë–î, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–≤ .gitignore)
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ .env                 # –°–µ–∫—Ä–µ—Ç—ã (–≤ .gitignore)
```

### –ü–∞–π–ø–ª–∞–π–Ω –ø–µ—Ä–µ–≤–æ–¥–∞

```mermaid
flowchart LR
    A[üìé PDF / EPUB] --> B[extractor.py]
    B -->|Markdown + –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è| C[translator.py]
    C -->|OpenAI API\n10 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö —á–∞–Ω–∫–æ–≤| D[–ü–µ—Ä–µ–≤–µ–¥—ë–Ω–Ω—ã–π Markdown]
    D --> E[generator.py]
    E -->|WeasyPrint / ebooklib| F[üìó PDF / EPUB]
```

### –ö–ª—é—á–µ–≤—ã–µ –º–æ–¥—É–ª–∏

| –ú–æ–¥—É–ª—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ |
|--------|-----------|------------|
| **extractor** | PDF ‚Üí Markdown —Å –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏, EPUB ‚Üí Markdown | `pymupdf4llm`, `fitz`, `ebooklib`, `html2text` |
| **translator** | –ß–∞–Ω–∫–æ–≤–∞–Ω–∏–µ + –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ | `openai` (gpt-4o-mini), `asyncio.Semaphore(10)` |
| **generator** | Markdown ‚Üí —Å—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π PDF/EPUB —Å –æ–±–ª–æ–∂–∫–æ–π –∏ –∫–æ–ª–æ—Ñ–æ–Ω–æ–º | `weasyprint`, `ebooklib`, `markdown` |
| **cover** | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–±–ª–æ–∂–∫–∏ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º –∏ –±—Ä–µ–Ω–¥–∏–Ω–≥–æ–º | `Pillow` |
| **database** | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –±–∞–ª–∞–Ω—Å, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | `aiosqlite`, SQLite |
| **handlers** | –í—Å—è –ª–æ–≥–∏–∫–∞ –±–æ—Ç–∞: –∫–æ–º–∞–Ω–¥—ã, inline-–∫–Ω–æ–ø–∫–∏, –ø–ª–∞—Ç–µ–∂–∏, –∞–¥–º–∏–Ω–∫–∞ | `python-telegram-bot` |

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (SQLite)

```sql
users (tg_id, username, balance, format, created_at)
transactions (id, tg_id, type, amount, details, created_at)
-- type: 'buy' | 'spend' | 'gift'
```

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
git clone https://github.com/izluchator/tg_transbooks_bot.git
cd tg_transbooks_bot

# –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python3 -m venv venv
source venv/bin/activate

# –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
cp .env.example .env
# –ó–∞–ø–æ–ª–Ω–∏—Ç—å .env

# –ó–∞–ø—É—Å–∫
python -m bot.main
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|-----------|----------|-------------|
| `TELEGRAM_BOT_TOKEN` | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ | ‚Äî |
| `OPENAI_API_KEY` | –ö–ª—é—á OpenAI API | ‚Äî |
| `OPENAI_MODEL` | –ú–æ–¥–µ–ª—å –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ | `gpt-4o-mini` |
| `CHUNK_SIZE` | –†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞ (—Å–∏–º–≤–æ–ª–æ–≤) | `3000` |
| `MAX_FILE_SIZE_MB` | –ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ | `50` |
| `ADMIN_USERNAME` | Username –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ | `apustota` |
| `STARS_PER_50_PAGES` | –°—Ç–æ–∏–º–æ—Å—Ç—å 50 —Å—Ç—Ä–∞–Ω–∏—Ü –≤ Stars | `20` |

---

## ü§ñ –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|---------|
| `/start` | –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å –±–∞–ª–∞–Ω—Å–æ–º |
| `/help` | –°–ø—Ä–∞–≤–∫–∞ |
| `/cancel` | –û—Ç–º–µ–Ω–∞ —Ç–µ–∫—É—â–µ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| `/admin` | –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ |

---

## üì¶ –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- **Runtime:** Python 3.11+
- **Telegram:** python-telegram-bot 21+
- **AI:** OpenAI API (gpt-4o-mini)
- **PDF:** PyMuPDF (fitz) + pymupdf4llm + WeasyPrint
- **EPUB:** ebooklib + html2text
- **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:** Pillow
- **–ë–î:** SQLite + aiosqlite
